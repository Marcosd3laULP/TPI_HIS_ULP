extends ../utilitario/layout

block content
  body.bg-sky-100.min-h-screen
    include ../utilitario/navRecepcion.pug

    //- Botón Volver
    div.px-8.mt-6.mb-4
      a(href="/pacientes/internaciones/emergencia" class="inline-block bg-red-500 text-white font-bold px-4 py-2 rounded hover:bg-red-600 transition") Volver

    h1(class="text-3xl font-bold text-center text-gray-800 mt-6 mb-6") Internación de Emergencia

    //- Mostrar mensaje de error
    if error
      p(class="text-red-600 font-bold text-center mb-4")= error

    //- Datos del paciente
    if paciente
      div(class="max-w-md mx-auto bg-white p-4 rounded-lg shadow-md mb-6")
        h2(class="text-2xl font-bold mb-2 text-gray-700") Datos del Paciente
        p ID: #{paciente.ID_paciente}
        p Nombre: #{paciente.Nombre}
        p Apellido: #{paciente.Apellido}
        p Sexo: #{paciente.Sexo}
    else
      p.text-center No se encontraron datos del paciente.

    hr

    h2(class="text-2xl font-bold text-gray-800 mb-4") Alojamientos disponibles en Emergencia

    //- Contenedores de alas en horizontal
    if alas && alas.length
      div(class="flex flex-wrap gap-6 overflow-x-auto px-4")
        each ala in alas
          div(class="flex-none bg-gray-50 rounded-lg shadow-md p-4 min-w-[300px]")
            h3(class="text-xl font-bold mb-2") Ala #{ala.Sector} (ID: #{ala.ID_ala})

            if ala.habitaciones && ala.habitaciones.length
              each hab in ala.habitaciones
                div(class="bg-white rounded-lg shadow-md p-4 mb-4")
                  h4(class="text-lg font-semibold mb-2") Habitación Nº #{hab.numero} (ID: #{hab.ID_hab})
                  p Capacidad: #{hab.capacidad}

                  if hab.camas && hab.camas.length
                    ul(class="space-y-2")
                      each cama in hab.camas
                        li(class="flex items-center justify-between bg-gray-100 px-2 py-1 rounded")
                          span Cama #{cama.Numero} - Estado: #{cama.Estado} - Sexo ocupante: #{cama.Sexo_ocupante || 'N/A'} (ID: #{cama.ID_cama})
                          if cama.Estado === 'Libre'
                            form(class="flex items-center gap-2" method="POST", action="/pacientes/internaciones/realizarInternacionDeEmergencia")
                              input(type="hidden", name="_csrf", value=csrfToken)
                              input(type="hidden", name="idCama", value=cama.ID_cama)
                              input(type="hidden", name="idPaciente", value=paciente ? paciente.ID_paciente : '')
                              input(type="hidden", name="sexoPaciente", value=paciente ? paciente.Sexo : '')

                              input(type="text", name="motivo", placeholder="Motivo", required class="border border-gray-300 rounded px-2 py-1")
                              button(type="submit" class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 transition") Internar
                          else
                            strong(class="text-red-600") ← Cama ocupada
                  else
                    p(class="text-gray-500") No hay camas registradas en esta habitación.
            else
              p(class="text-gray-500") No hay habitaciones registradas en esta ala.
    else
      p.text-center No se encontraron alas de emergencia registradas 
