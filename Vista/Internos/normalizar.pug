block content
  h1.text-2xl.font-bold.text-center.my-6 Normalización de Paciente

  // Mensaje de resultado de búsqueda
  if mensaje
    p(style="color:blue; font-weight:bold;") #{mensaje}

  // Formulario para buscar paciente por DNI
  form(method="POST", action="/pacientes/internaciones/normalizar/buscar" class="flex items-center gap-2 mb-4")
    input(type="hidden", name="_csrf", value=csrfToken)
    input(type="hidden", name="idPacienteEmergencia", value=idPacienteEmergencia)
    
    label(for="dni") DNI del paciente:
    input(type="text" name="dni" required class="border px-2 py-1 rounded")
    button(type="submit" class="bg-blue-600 text-white px-4 py-1 rounded hover:bg-blue-700") Buscar

  hr

  // Formulario oculto para normalización
  form(method="POST", action="/pacientes/internaciones/normalizar/guardar")
    input(type="hidden", name="_csrf", value=csrfToken)
    input(type="hidden", name="idPacienteEmergencia", value=idPacienteEmergencia)
    input(type="hidden", name="idPacienteNormal", value=idPacienteNormal)

    p Paciente a normalizar: #{idPacienteEmergencia || 'No asignado'}
    p Paciente seleccionado: #{idPacienteNormal || 'No seleccionado'}

    // Solo un botón para completar la normalización si el paciente está seleccionado
    if idPacienteNormal
      button(type="submit" class="bg-green-600 text-white px-4 py-1 rounded hover:bg-green-700") Normalizar

  hr

  // Enlace dinámico: SOLO mostrar después de la búsqueda
  if mensaje 
    if idPacienteNormal
      a(href=`/pacientes/internaciones/confirmar/${idPacienteNormal}/${idPacienteEmergencia}` class="text-blue-600 hover:underline") Confirmar normalización
    else
      a(href=`/pacientes/internaciones/registroAnonimo/${idPacienteEmergencia}` class="text-red-600 hover:underline") Registrar paciente anónimo
